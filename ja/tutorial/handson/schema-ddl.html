<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta name="keywords" content="DBFlute,チュートリアル,ハンズオン,hands-on" />
	<link rel="stylesheet" type="text/css" href="../../../css/sub.css" />
	<!--[if IE 6.0]>
		<link rel="stylesheet" type="text/css" href="../../../css/cb/sub.css" />
	<![endif]--> 
	<title>ハンズオンで利用するDDL | DBFlute</title>
</head>
<body>
<div id="container" class="ct-tutorial">

<div id="mainbar">
<div id="header">
	<div class="navi-upper"><a href="../../../ja/sitemap.html">SiteMap</a>|<a href="http://d.hatena.ne.jp/jflute/">Author's Blog</a></div>
	<div class="navi-main">
	<ul>
		<li class="hd-introduction"><a href="../../../ja/introduction/index.html"><img src="../../../image/parts/navi/link-intro.png" alt="Introduction" width="75" height="32" /></a></li>
		<li class="hd-tutorial"><a href="../../../ja/tutorial/index.html"><img src="../../../image/parts/navi/link-tuto.png" alt="Tutorial" width="56" height="24" /></a>
			<ul>
				<li class="hd-architect"><a href="../../../ja/tutorial/architect.html"><img src="../../../image/parts/navi/link-arch.png" alt="for Architect" width="80" height="24" /></a></li>
				<li class="hd-developer"><a href="../../../ja/tutorial/developer.html"><img src="../../../image/parts/navi/link-dev.png" alt="for Developer" width="87" height="24" /></a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../ja/environment/index.html"><img src="../../../image/parts/navi/link-env.png" alt="Environment" width="84" height="25" /></a>
			<ul>
				<li class="hd-install"><a href="../../../ja/environment/setup/index.html"><img src="../../../image/parts/navi/link-setup.png" alt="Setup" width="42" height="24" /></a></li>
				<li class="hd-upgrade"><a href="../../../ja/environment/upgrade/index.html"><img src="../../../image/parts/navi/link-upgrade.png" alt="Upgrade" width="61" height="25" /></a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../ja/manual/index.html"><img src="../../../image/parts/navi/link-manual.png" alt="Manual" width="62" height="25" /></a></li>
	</ul>
	</div>
</div>

<div id="content">
	<h1>ハンズオンで利用するDDL</h1>
	<ul class="indexlist">
		<li><a href="#system">システムユーザのDDL</a></li>
		<li><a href="#basic">基本的なテーブルのDDL</a></li>
	</ul>

	<h2 id="system">システムユーザのDDL</h2>
<pre><span class="codetitle">ex) ハンズオンで利用する基本的なテーブルのDDL @replace-schema-00-system.sql</span><code>
-- #df:changeUser(system)#
-- #df:checkUser()#
CREATE DATABASE /*$mainDatabase*/;

-- #df:reviveUser()#
-- #df:checkUser()#
GRANT ALL PRIVILEGES ON /*$mainDatabase*/.* TO /*$mainUser*/@localhost IDENTIFIED BY '/*$mainPassword*/';
FLUSH PRIVILEGES;
</code></pre>

	<h2 id="basic">基本的なテーブルのDDL</h2>
<pre><span class="codetitle">ex) ハンズオンで利用する基本的なテーブルのDDL @replace-schema-10-basic.sql</span><code>
CREATE TABLE PURCHASE(
    PURCHASE_ID BIGINT AUTO_INCREMENT NOT NULL COMMENT '購入ID: 連番',
    MEMBER_ID INTEGER NOT NULL COMMENT '会員ID',
    PRODUCT_ID INTEGER NOT NULL COMMENT '商品ID: 購入した商品のID',
    PURCHASE_DATETIME DATETIME NOT NULL COMMENT '購入日時: 購入したときの日時',
    PURCHASE_COUNT INTEGER NOT NULL COMMENT '購入数量: 購入した商品の個数',
    PURCHASE_PRICE INTEGER NOT NULL COMMENT '購入価格: 購入商品の数量合計の価格',
    PAYMENT_COMPLETE_FLG INTEGER NOT NULL COMMENT '支払完了フラグ: これが長い間falseだと要注意',
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (PURCHASE_ID),
    UNIQUE (MEMBER_ID, PRODUCT_ID, PURCHASE_DATETIME),
    KEY (MEMBER_ID),
    KEY (PRODUCT_ID)
) COMMENT='購入' ;


CREATE TABLE MEMBER_ADDRESS(
    MEMBER_ADDRESS_ID INTEGER AUTO_INCREMENT NOT NULL,
    MEMBER_ID INTEGER NOT NULL,
    VALID_BEGIN_DATE DATE NOT NULL COMMENT '有効開始日: 有効期間の開始日。
前の終了日の一日後の値が格納される',
    VALID_END_DATE DATE NOT NULL COMMENT '有効終了日: 有効期間の終了日。
次の有効開始日の一日前の値が格納される',
    ADDRESS VARCHAR(200) NOT NULL COMMENT '住所: 住所をまるごと',
    REGION_ID INTEGER NOT NULL,
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (MEMBER_ADDRESS_ID),
    UNIQUE (MEMBER_ID, VALID_BEGIN_DATE)
) COMMENT='会員住所情報';


CREATE TABLE MEMBER_LOGIN(
    MEMBER_LOGIN_ID BIGINT AUTO_INCREMENT NOT NULL,
    MEMBER_ID INTEGER NOT NULL,
    LOGIN_DATETIME DATETIME NOT NULL,
    MOBILE_LOGIN_FLG INTEGER NOT NULL,
    LOGIN_MEMBER_STATUS_CODE CHAR(3) NOT NULL,
    PRIMARY KEY (MEMBER_LOGIN_ID),
    UNIQUE (MEMBER_ID, LOGIN_DATETIME)
) COMMENT='会員ログイン情報';


CREATE TABLE MEMBER_SECURITY(
    MEMBER_ID INTEGER NOT NULL,
    LOGIN_PASSWORD VARCHAR(50) NOT NULL,
    REMINDER_QUESTION VARCHAR(50) NOT NULL,
    REMINDER_ANSWER VARCHAR(50) NOT NULL,
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (MEMBER_ID)
) COMMENT='会員セキュリティ情報';


CREATE TABLE MEMBER_SERVICE(
    MEMBER_ID INTEGER NOT NULL,
    POINT_COUNT INTEGER NOT NULL,
    SERVICE_RANK_CODE CHAR(3) NOT NULL,
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (MEMBER_ID)
) COMMENT='会員サービス情報';


CREATE TABLE MEMBER_WITHDRAWAL(
    MEMBER_ID INTEGER NOT NULL,
    WITHDRAWAL_REASON_CODE CHAR(3),
    WITHDRAWAL_REASON_INPUT_TEXT TEXT,
    WITHDRAWAL_DATETIME DATETIME NOT NULL,
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (MEMBER_ID)
) COMMENT='会員退会情報';


CREATE TABLE PRODUCT(
    PRODUCT_ID INTEGER AUTO_INCREMENT NOT NULL,
    PRODUCT_NAME VARCHAR(50) NOT NULL,
    PRODUCT_HANDLE_CODE VARCHAR(100) NOT NULL,
    PRODUCT_CATEGORY_CODE CHAR(3) NOT NULL,
    PRODUCT_STATUS_CODE CHAR(3) NOT NULL,
    REGULAR_PRICE INTEGER NOT NULL,
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (PRODUCT_ID),
    UNIQUE (PRODUCT_HANDLE_CODE)
) COMMENT='商品';


CREATE TABLE MEMBER(
    MEMBER_ID INTEGER AUTO_INCREMENT NOT NULL COMMENT '会員ID: 連番',
    MEMBER_NAME VARCHAR(200) NOT NULL COMMENT '会員名称: 会員の表示用の名称(姓名)',
    MEMBER_ACCOUNT VARCHAR(50) NOT NULL COMMENT '会員アカウント: ログイン時のユーザ名',
    MEMBER_STATUS_CODE CHAR(3) NOT NULL COMMENT '会員ステータスコード',
    FORMALIZED_DATETIME DATETIME COMMENT '正式会員日時: 正式会員になるまでnullで、なったらずっとそのまま',
    BIRTHDATE DATE COMMENT '生年月日',
    REGISTER_DATETIME DATETIME NOT NULL,
    REGISTER_USER VARCHAR(200) NOT NULL,
    REGISTER_PROCESS VARCHAR(200) NOT NULL,
    UPDATE_DATETIME DATETIME NOT NULL,
    UPDATE_USER VARCHAR(200) NOT NULL,
    UPDATE_PROCESS VARCHAR(200) NOT NULL,
    VERSION_NO BIGINT NOT NULL,
    PRIMARY KEY (MEMBER_ID),
    UNIQUE (MEMBER_ACCOUNT)
) COMMENT='会員: 会員登録時にInsertされる。
物理削除されることはない';


CREATE TABLE WITHDRAWAL_REASON(
    WITHDRAWAL_REASON_CODE CHAR(3) NOT NULL,
    WITHDRAWAL_REASON_TEXT TEXT NOT NULL,
    DISPLAY_ORDER INTEGER NOT NULL,
    PRIMARY KEY (WITHDRAWAL_REASON_CODE),
    UNIQUE (DISPLAY_ORDER)
) COMMENT='退会理由';


CREATE TABLE PRODUCT_CATEGORY(
    PRODUCT_CATEGORY_CODE CHAR(3) NOT NULL,
    PRODUCT_CATEGORY_NAME VARCHAR(50) NOT NULL,
    PARENT_CATEGORY_CODE CHAR(3),
    PRIMARY KEY (PRODUCT_CATEGORY_CODE)
) COMMENT='商品カテゴリ';


CREATE TABLE PRODUCT_STATUS(
    PRODUCT_STATUS_CODE CHAR(3) NOT NULL,
    PRODUCT_STATUS_NAME VARCHAR(50) NOT NULL,
    PRIMARY KEY (PRODUCT_STATUS_CODE)
) COMMENT='商品ステータス';


CREATE TABLE REGION(
    REGION_ID INTEGER NOT NULL,
    REGION_NAME VARCHAR(50) NOT NULL,
    PRIMARY KEY (REGION_ID)
) COMMENT='地域';


CREATE TABLE SERVICE_RANK(
    SERVICE_RANK_CODE CHAR(3) NOT NULL,
    SERVICE_RANK_NAME VARCHAR(50) NOT NULL,
    POINT_INCIDENCE NUMERIC(5, 3) NOT NULL,
    NEW_ACCEPTABLE_FLG INTEGER NOT NULL,
    DESCRIPTION VARCHAR(200) NOT NULL,
    DISPLAY_ORDER INTEGER NOT NULL,
    PRIMARY KEY (SERVICE_RANK_CODE),
    UNIQUE (DISPLAY_ORDER)
) COMMENT='サービスランク';


CREATE TABLE MEMBER_STATUS(
    MEMBER_STATUS_CODE CHAR(3) NOT NULL,
    MEMBER_STATUS_NAME VARCHAR(50) NOT NULL,
    DESCRIPTION VARCHAR(200) NOT NULL,
    DISPLAY_ORDER INTEGER NOT NULL,
    PRIMARY KEY (MEMBER_STATUS_CODE),
    UNIQUE (DISPLAY_ORDER)
) COMMENT='会員ステータス';


ALTER TABLE MEMBER ADD CONSTRAINT FK_MEMBER_MEMBER_STATUS 
    FOREIGN KEY (MEMBER_STATUS_CODE) REFERENCES MEMBER_STATUS (MEMBER_STATUS_CODE);

ALTER TABLE MEMBER_ADDRESS ADD CONSTRAINT FK_MEMBER_ADDRESS_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE MEMBER_ADDRESS ADD CONSTRAINT FK_MEMBER_ADDRESS_REGION 
    FOREIGN KEY (REGION_ID) REFERENCES REGION (REGION_ID);

ALTER TABLE MEMBER_LOGIN ADD CONSTRAINT FK_MEMBER_LOGIN_MEMBER_STATUS 
    FOREIGN KEY (LOGIN_MEMBER_STATUS_CODE) REFERENCES MEMBER_STATUS (MEMBER_STATUS_CODE);

ALTER TABLE MEMBER_LOGIN ADD CONSTRAINT FK_MEMBER_LOGIN_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE MEMBER_SERVICE ADD CONSTRAINT FK_MEMBER_SERVICE_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE MEMBER_SERVICE ADD CONSTRAINT FK_MEMBER_SERVICE_SERVICE_RANK_CODE 
    FOREIGN KEY (SERVICE_RANK_CODE) REFERENCES SERVICE_RANK (SERVICE_RANK_CODE);

ALTER TABLE MEMBER_SECURITY ADD CONSTRAINT FK_MEMBER_SECURITY_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE MEMBER_WITHDRAWAL ADD CONSTRAINT FK_MEMBER_WITHDRAWAL_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE MEMBER_WITHDRAWAL ADD CONSTRAINT FK_MEMBER_WITHDRAWAL_WITHDRAWAL_REASON 
    FOREIGN KEY (WITHDRAWAL_REASON_CODE) REFERENCES WITHDRAWAL_REASON (WITHDRAWAL_REASON_CODE);

ALTER TABLE PURCHASE ADD CONSTRAINT FK_PURCHASE_MEMBER 
    FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER (MEMBER_ID);

ALTER TABLE PURCHASE ADD CONSTRAINT FK_PURCHASE_PRODUCT 
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT (PRODUCT_ID);

ALTER TABLE PRODUCT ADD CONSTRAINT FK_PRODUCT_PRODUCT_CATEGORY 
    FOREIGN KEY (PRODUCT_CATEGORY_CODE) REFERENCES PRODUCT_CATEGORY (PRODUCT_CATEGORY_CODE);

ALTER TABLE PRODUCT ADD CONSTRAINT FK_PRODUCT_PRODUCT_STATUS 
    FOREIGN KEY (PRODUCT_STATUS_CODE) REFERENCES PRODUCT_STATUS (PRODUCT_STATUS_CODE);

ALTER TABLE PRODUCT_CATEGORY ADD CONSTRAINT FK_PRODUCT_CATEGORY_PARENT 
    FOREIGN KEY (PARENT_CATEGORY_CODE) REFERENCES PRODUCT_CATEGORY (PRODUCT_CATEGORY_CODE);


CREATE INDEX IX_MEMBER_MEMBER_NAME ON MEMBER(MEMBER_NAME);
CREATE INDEX IX_MEMBER_FORMALIZED_DATETIME ON MEMBER(FORMALIZED_DATETIME);
CREATE INDEX IX_MEMBER_LOGIN_DATETIME ON MEMBER_LOGIN(LOGIN_DATETIME);
CREATE INDEX IX_MEMBER_SERVICE_POINT_COUNT ON MEMBER_SERVICE(POINT_COUNT);
CREATE INDEX IX_PURCHASE_PRODUCT_DATETIME ON PURCHASE(PRODUCT_ID, PURCHASE_DATETIME);
CREATE INDEX IX_PURCHASE_DATETIME_MEMBER ON PURCHASE(PURCHASE_DATETIME, MEMBER_ID);
CREATE INDEX IX_PURCHASE_PRICE ON PURCHASE(PURCHASE_PRICE);
CREATE INDEX IX_PRODUCT_PRODUCT_NAME ON PRODUCT(PRODUCT_NAME);
</code></pre>

</div>
</div>

<div id="sidebar">
	<div class="logo"><a href="../../../"><img src="../../../image/parts/logo.png" alt="dbflute-logo" width="240" height="110" /></a></div>
<ul>
		<li><a href="../../../ja/tutorial/architect.html">アーキテクトのチュートリアル</a>
			<ul>
				<li><a href="../../../ja/tutorial/architect.html#knowledge">必要な知識</a></li>
				<li><a href="../../../ja/tutorial/architect.html#action">開発時にやるべきこと</a></li>
				<li><a href="../../../ja/tutorial/architect.html#various">雑多な情報</a></li>
			</ul>
		</li>
		<li><a href="../../../ja/tutorial/developer.html">ディベロッパーのチュートリアル</a>
			<ul>
				<li><a href="../../../ja/tutorial/developer.html#exampledb">ExampleDB (前提)</a></li>
				<li><a href="../../../ja/tutorial/developer.html#about">DBFluteとは？</a></li>
				<li class="upper-space"><a href="../../../ja/tutorial/developer.html#style">DBアクセスのスタイル</a></li>
				<li><a href="../../../ja/tutorial/developer.html#object">意識するクラス</a></li>
				<li><a href="../../../ja/tutorial/developer.html#task">意識するタスク</a></li>
				<li class="upper-space"><a href="../../../ja/tutorial/developer.html#example">Exampleのススメ</a></li>
				<li><a href="../../../ja/tutorial/developer.html#offer">アーキテクトへの相談</a></li>
			</ul>
		</li>
	</ul>

</div>

<div id="footer">
	<div><a href="../../../ja/sitemap.html">SiteMap</a> <a href="http://d.hatena.ne.jp/jflute">Author's Blog</a><a href="https://www.seasar.org/issues/browse/DBFLUTE">BTS</a></div>
	<ul class="footer-navi">
		<li class="hd-introduction"><a href="../../../ja/introduction/index.html">Introduction</a></li>
		<li class="hd-tutorial"><a href="../../../ja/tutorial/index.html">Tutorial</a>
			<ul>
				<li class="hd-architect"><a href="../../../ja/tutorial/architect.html">for Architect</a></li>
				<li class="hd-developer"><a href="../../../ja/tutorial/developer.html">for Developer</a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../ja/environment/index.html">Environment</a>
			<ul>
				<li class="hd-install"><a href="../../../ja/environment/setup/index.html">Setup</a></li>
				<li class="hd-upgrade"><a href="../../../ja/environment/upgrade/index.html">Upgrade</a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../ja/manual/index.html">Manual</a></li>
	</ul>

</div>

</div>
</body>
</html>
