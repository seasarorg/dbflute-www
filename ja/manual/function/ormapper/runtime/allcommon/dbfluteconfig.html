<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta name="keywords" content="DBFlute,allcommon,自動生成される共通クラス,DBFluteConfig" />
	<link rel="stylesheet" type="text/css" href="../../../../../../css/sub.css" />
	<!--[if IE 6.0]>
		<link rel="stylesheet" type="text/css" href="../../../../../../css/cb/sub.css" />
	<![endif]--> 
	<title>DBFluteConfig | DBFlute</title>
</head>
<body>
<div id="container" class="ct-manual">

<div id="mainbar">
<div id="header">
	<div class="navi-upper"><a href="../../../../../../ja/sitemap.html">SiteMap</a>|<a href="http://d.hatena.ne.jp/jflute/">Author's Blog</a></div>
	<div class="navi-main">
	<ul>
		<li class="hd-introduction"><a href="../../../../../../ja/introduction/index.html"><img src="../../../../../../image/parts/navi/link-intro.png" alt="Introduction" width="75" height="32" /></a></li>
		<li class="hd-tutorial"><a href="../../../../../../ja/tutorial/index.html"><img src="../../../../../../image/parts/navi/link-tuto.png" alt="Tutorial" width="56" height="24" /></a>
			<ul>
				<li class="hd-architect"><a href="../../../../../../ja/tutorial/architect.html"><img src="../../../../../../image/parts/navi/link-arch.png" alt="for Architect" width="80" height="24" /></a></li>
				<li class="hd-developer"><a href="../../../../../../ja/tutorial/developer.html"><img src="../../../../../../image/parts/navi/link-dev.png" alt="for Developer" width="87" height="24" /></a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../../../../ja/environment/index.html"><img src="../../../../../../image/parts/navi/link-env.png" alt="Environment" width="84" height="25" /></a>
			<ul>
				<li class="hd-install"><a href="../../../../../../ja/environment/setup/index.html"><img src="../../../../../../image/parts/navi/link-setup.png" alt="Setup" width="42" height="24" /></a></li>
				<li class="hd-upgrade"><a href="../../../../../../ja/environment/upgrade/index.html"><img src="../../../../../../image/parts/navi/link-upgrade.png" alt="Upgrade" width="61" height="25" /></a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../../../../ja/manual/index.html"><img src="../../../../../../image/parts/navi/link-manual.png" alt="Manual" width="62" height="25" /></a></li>
	</ul>
	</div>
</div>

<div id="content">
	<h1>DBFluteConfig</h1>
	<ul class="indexlist">
		<li><a href="#about">DBFluteConfigとは？</a>
			<ul>
				<li><a href="#beforeinit">初期化される前に設定すること</a></li>
				<li><a href="#unitconfig">単体テストの環境でも設定すること</a></li>
				<li><a href="#settinglog">設定されたときのログ</a></li>
			</ul>
		</li>
		<li><a href="#defaultstatementconfig">defaultStatementConfig</a></li>
		<li><a href="#queryloglevelinfo">queryLogLevelInfo</a></li>
		<li><a href="#executestatusloglevelinfo">executeStatusLogLevelInfo</a></li>
		<li><a href="#logdateformat">logDateFormat</a></li>
		<li><a href="#logtimestampformat">logTimestampFormat</a></li>
		<li><a href="#datasourcehandler">dataSourceHandler</a></li>
		<li><a href="#physicalconnectiondigger">physicalConnectionDigger</a></li>
		<li><a href="#sequencecachekeygenerator">sequenceCacheKeyGenerator</a></li>
		<li><a href="#sqlclausecreator">sqlClauseCreator</a></li>
		<li><a href="#tablesqlnamefilter">tableSqlNameFilter</a></li>
		<li><a href="#outsidesqlpackage">outsideSqlPackage</a></li>
		<li><a href="#outsidesqlexecutorfactory">outsideSqlExecutorFactory</a></li>
		<li><a href="#usesqllogregistry">useSqlLogRegistry</a></li>
		<li><a href="#fulltextsearchoperand">fullTextSearchOperand</a></li>
		<li><a href="#valuetype">valueType</a>
			<ul>
				<li><a href="#basicvaluetype">基本ValueType</a></li>
				<li><a href="#pluginvaluetype">プラグインValueType</a></li>
			</ul>
		</li>
	</ul>

	<h2 id="about">DBFluteConfigとは？</h2>
	<p>
		アプリケーション実行時にDBFluteのランタイム環境を調整するコンフィグです。
	</p>
	<p>
		DBFluteプロパティとは違い、設定ファイルではなく、allcommon配下に自動生成されるシングルトンのクラスとなっています。
		自動生成時に(挙動を)固定してしまうのではなく、アプリケーションの実行環境で柔軟に切り替えられるようにするためです。
	</p>
<pre><span class="codetitle">ex) DBFluteConfigインスタンスの取得 @Java</span><code>
DBFluteConfig config = DBFluteConfig.<span class="point">getInstance()</span>;
</code></pre>
	<p>
		様々なコンフィグが用意されていて、それぞれのメソッドで設定を行うことができます。
		おいそれと変更してはいけないプロパティがオンパレードなため、
		設定するときは必ず設定前にロックを解除し、設定後にロックを掛けるという微妙に面倒な作業と共にすることを習慣としています。
	</p>
<pre><span class="codetitle">ex) DBFluteConfigで queryTimeout の設定 {300秒} @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.<span class="point">unlock()</span>;
config.<span class="point">setDefaultStatementConfig</span>(<span class="keyword">new</span> StatementConfig().queryTimeout(<span class="literal">300</span>));
config.<span class="point">lock()</span>;
</code></pre>
	<h3 id="beforeinit">初期化される前に設定すること</h3>
	<p>
		<em class="keyword">DBFluteが初期化される前(DIコンテナが初期化される前)に設定されることが大前提</em>
		です。それ以降の設定は推奨されません。(DBFluteの初期化が終わると、ロックし忘れを防止するために自動的にロックが掛けられます)
	</p>
	<h3 id="unitconfig">単体テストの環境でも設定すること</h3>
	<p>
		単体テストの環境でも共通の設定がある場合は、テストケースの初期化時などにDBFluteConfigの設定をすることを忘れないようにして下さい。
	</p>
	<h3 id="settinglog">設定されたときのログ</h3>
	<p>
		どのコンフィグにおいても、設定されたときはINFOレベルのログが出力されます。
		とても重要な設定であること、かつ、初期化時に一回だけ設定されるのが前提であることからそのようにしています。
	</p>

	<h2 id="defaultstatementconfig">defaultStatementConfig</h2>
	<p>
		全ての検索に適用するデフォルトの StatementConfig を設定します。設定した
		StatementConfig インスタンスがDBFlute内部で利用されます。設定後にそのインスタンスの設定値を変更してはいけません。
	</p>
	<div class="relatedpage"><a href="../statementconfig.html">StatementConfig</a></div>

	<h2 id="queryloglevelinfo">queryLogLevelInfo</h2>
	<p>
		QueryLog のレベルを INFO に設定します(通常は、DEBUGレベル)。
	</p>

	<h2 id="executestatusloglevelinfo">executeStatusLogLevelInfo</h2>
	<p>
		ExecuteStatusLog のレベルを INFO に設定します(通常は、DEBUGレベル)。
	</p>

	<h2 id="logdateformat">logDateFormat</h2>
	<p>
		SQL実行時に出力される表示用SQLの日付型の条件値の表示フォーマットを設定します。
		デフォルトのフォーマットが都合悪いときに利用します。
		java.util.Dateにマッピングされたカラムに対して有効です。SimpleDateFormatが解釈できる形式で指定します。
	</p>
	<div class="relatedpage"><a href="../displaysql.html#dateformat">表示用SQL - 日付・日時型のフォーマット</a></div>
<pre><span class="codetitle">ex) 独自の日付型フォーマットを設定 {スラッシュを利用} @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.setLogDateFormat(<span class="literal">"yyyy/MM/dd"</span>);
</code></pre>
	<p>
		フォーマットされた後の日付表現の前後に、独自の文字列を追加したい場合は、"${yyyy-MM...}"
		形式でフォーマットを囲って、その前後に独自の文字列を記述して設定します。		
	</p>
<pre><span class="codetitle">ex) 日付フォーマットでdateリテラルを付与 @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.setLogDateFormat(<span class="literal">"date ${yyyy/MM/dd}"</span>);
</code></pre>
	<p>
		主に、Oracleのtimestampリテラルの付与の用途などで利用します。但し、Oracleに関しては既にデフォルトで timestamp
		リテラルが付与されるようになっているため、必要になる場面はあまりないと想定されています。
		(そのOracleのデフォルト設定をフォーマットだけちょっと変えて上書きするような場合には必要になります)
	</p>

	<h2 id="logtimestampformat">logTimestampFormat</h2>
	<p>
		SQL実行時に出力される表示用SQLの日時型の条件値の表示フォーマットを設定します。
		デフォルトのフォーマットが都合悪いときに利用します。
		java.sql.Timestampにマッピングされたカラムに対して有効です。SimpleDateFormatが解釈できる形式で指定します。
	</p>
	<div class="relatedpage"><a href="../displaysql.html#dateformat">表示用SQL - 日付・日時型のフォーマット</a></div>
<pre><span class="codetitle">ex) 独自の日時型フォーマットを設定 {スラッシュを利用} @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.setLogTimestampFormat(<span class="literal">"yyyy/MM/dd HH:mm:ss.SSS"</span>);
</code></pre>
	<p>
		リテラルの付与に関しては、logDateFormat と同様です。
	</p>

	<h2 id="datasourcehandler">dataSourceHandler</h2>
	<p>
		DBFlute内部で DataSource からのコネクションの取得処理をフィルタします。
	</p>

	<h2 id="physicalconnectiondigger">physicalConnectionDigger</h2>
	<p>
		論理コネクションから物理コネクションを取得するコールバック処理を設定します<span class="freecomment">(@since 0.9.7.6)</span>。
	</p>
	<p>
		DBFluteは、DIコンテナ経由でアプリから渡された DataSource を利用してコネクションを取得しています。
		ゆえに、DBFluteはそのコネクションが論理的なものなのか物理的なものなのかは意識していません。
		通常は、それで全く問題ありませんが、一部機能でどうしても物理コネクションが必要になることがあります。
		その機能を利用する時のために、アプリの DBCP 構成に合わせた物理コネクション処理を登録します。
	</p>
	<p>
		代表的な例として、Oracleのプロシージャパラメータに、TABLE型やOBJECT型のデータを指定するときに利用します。
		(基本的には、DBMSのJDBCドライバに依存せざるを得ない機能を使うときに必要になる可能性があります)
	</p>
	<div class="relatedpage"><a href="../../../../reference/dbway/oracle/oraclearraystruct.html">Oracleの配列・構造体パラメータ</a></div>

	<h2 id="sequencecachekeygenerator">sequenceCacheKeyGenerator</h2>
	<p>
		シーケンスキャッシュのキーを生成する処理を設定します。
	</p>
	<div class="relatedpage"><a href="../../../genbafit/runtimefit/sequencecache/index.html">現場フィット - シーケンスキャッシュ</a></div>

	<h2 id="sqlclausecreator">sqlClauseCreator</h2>
	<p>
		ConditionBean の 内部でSQLを組み立てるクラス、SqlClause のファクトリクラスを差し替えます。
		ConditionBean で発行されるSQLを拡張したいときに利用します。(ただし、拡張リスクがあります)
	</p>

	<h2 id="tablesqlnamefilter">tableSqlNameFilter</h2>
	<p>
		自動組み立てをする SQL のテーブル名をフィルタします<span class="freecomment">(@since 0.9.7.6)</span>。
		例えば、スキーマ名の修飾を環境ごとのスイッチさせたいような場合に利用します。
		(ただし、スキーマ名の静的な修飾は、別途機能として用意されていますのでそちらをご利用下さい)
	</p>
	<div class="relatedpage"><span class="working"><!-- <a href="../../../genbafit/projectfit/schematablename/index.html"> -->現場フィット - 実行されるSQL(CB)のテーブル名にスキーマ名を付与<!-- </a> --></span></div>
<pre><span class="codetitle">ex) PUBLICというスキーマ名をテーブル名に付与する @Java</span><code>
<span class="keyword">final</span> String schema = <span class="attribute">"PUBLIC"</span>; <span class="comment">// 実業務ではアプリのプロパティなどから取得</span> 
DBFluteConfig.getInstance().<span class="point">setTableSqlNameFilter</span>(<span class="keyword">new</span> SqlNameFilter() {
    <span class="keyword">public</span> String filter(String sqlName) {
        <span class="keyword">return</span> schema + <span class="attribute">"."</span> + sqlName;
    }
});
</code></pre>
	<p>
		外だしSQLには影響しません。このフィルタは、Behavior や ConditionBean
		などのSQLの自動組み立て処理が対象となります。
	</p>
	<p>
		このフィルタの設定は、必ずコンテナの初期化の前に設定する必要があります。そもそも DBFluteConfig
		はそういった利用を想定していますが、このコンフィグは初期化後にロックを解除して設定しても反映されない可能性があります。
		具体的には、このフィルタは各テーブルの DBMeta クラスがクラスロードされたときに利用されるためです。
	</p>
	<p>
		また、Generateタスク実行時に TableSqlName をフィルタするような機能を併用する場合、コールバックの引数は既にそのフィルタが実行された値となります。
		具体的には、スキーマ名の静的な修飾を行う SchemaTableName や、予約語テーブル名のためのクォーテーション処理などです。
	</p>
	<div class="relatedpage"><span class="working"><!-- <a href="../../../genbafit/projectfit/schematablename/index.html"> -->現場フィット - 実行されるSQL(CB)のテーブル名にスキーマ名を付与<!-- </a> --></span></div>
	<div class="relatedpage"><a href="../../../../reference/dfprop/littleadjustment/index.html#quotetablenamelist">dfprop - quoteTableNameList</a></div>

	<h2 id="outsidesqlpackage">outsideSqlPackage</h2>
	<p>
		外だしSQLの配置パッケージを変更します。
	</p>

	<h2 id="outsidesqlexecutorfactory">outsideSqlExecutorFactory</h2>
	<p>
		
	</p>

	<h2 id="usesqllogregistry">useSqlLogRegistry</h2>
	<p>
		
	</p>

	<h2 id="fulltextsearchoperand">fullTextSearchOperand</h2>
	<p>
		
	</p>

	<h2 id="valuetype">valueType</h2>
	<p>
		独自の ValueType を設定することができます。
	</p>
	<div class="relatedword"><a href="../../../../reference/dictionary/alphabet/wv.html#valuetype">ValueType</a></div>
	<h3 id="basicvaluetype">基本ValueType</h3>
	<p>
		プログラム型をキーに ValueType を指定します。
		独自のプログラム型を利用する場合などに有効です。typeMappingMap.dfprop
		と連携して利用することがほとんどの利用パターンです。ただし、<em class="keyword">厳重注意のもと利用すること</em>。
		特にデフォルトで登録されている ValueType を差し替えた場合、DBFluteが正常に動作しない可能性もあります。
	</p>
<pre><span class="codetitle">ex) 独自の基本ValueTypeを登録 @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.<span class="point">registerBasicValueType</span>(KorondeItai.class, <span class="keyword">new</span> KolobValueType());
</code></pre>
	<div class="relatedpage"><a href="../../../../reference/dfprop/typemapping/index.html">typeMappingMap.dfprop</a></div>
	<div class="relatedword"><a href="../../../../reference/dictionary/alphabet/wb.html#basicvaluetype">BasicValueType (基本ValueType)</a></div>
	<h3 id="pluginvaluetype">プラグインValueType</h3>
	<p>
		名前をキーに ValueType を指定します。設定したキーを指定して、どのカラムでどの ValueType
		を指定するか手動で設定します。
		ピンポイントで <em class="keyword">このカラムだけ、この ValueType を利用するようにしたい</em>
		という場合に有効です。ただし、<em class="keyword">厳重注意のもと利用すること</em>。
		特にデフォルトで登録されている ValueType を差し替えた場合、DBFluteが正常に動作しない可能性もあります。
	</p>
<pre><span class="codetitle">ex) 独自のプラグインValueTypeを登録 @Java</span><code>
DBFluteConfig config = DBFluteConfig.getInstance();
config.<span class="point">registerPluginValueType</span>(<span class="literal">"korondeItai"</span>, <span class="keyword">new</span> KolobValueType());
</code></pre>
<pre><span class="codetitle">ex) 独自のプラグインValueTypeを利用 @Java</span><code>
<span class="comment">// EntityのExクラスにて</span>
<span class="keyword">public static final</span> String memberName_VALUE_TYPE = <span class="literal">"korondeItai"</span>;
</code></pre>
	<p>
		定数アノテーションの [プロパティ名]_VALUE_TYPE のプロパティ名は、JavaBeansルールに従うこと。
		例えば、"T_NAME" カラムだったら、プロパティ名は、"TName"。(tNameではない)
	</p>
	<p>
		ConditionBean の検索条件のバインド変数においては、このプラグインValueTypeは利用されません。
		データの取得処理や、登録・更新などのバインド変数に限ります。
	</p>

<p>TODO jflute now writing</p>

</div>
</div>

<div id="sidebar">
	<div class="logo"><a href="../../../../../../"><img src="../../../../../../image/parts/logo.png" alt="dbflute-logo" width="240" height="110" /></a></div>
<ul>
		<li><a href="../../../../../../ja/manual/function/generator/index.html">自動生成ツール</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/generator/client/index.html">DBFluteクライアント</a></li>
				<li><a href="../../../../../../ja/manual/function/generator/module/index.html">DBFluteモジュール</a></li>
				<li><a href="../../../../../../ja/manual/function/generator/task/index.html">DBFluteタスク</a>
				<!-- 
					<ul>
						<li><a href="../../../../../../ja/manual/function/generator/task/jdbc/index.html">JDBC</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/generate/index.html">Generate</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/doc/index.html">Doc</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/sql2entity/index.html">Sql2Entity</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/outsidesqltest/index.html">OutsideSqlTest</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/replaceschema/index.html">ReplaceSchema</a></li>
					</ul>
				 -->
				</li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/function/ormapper/index.html">O/Rマッパ</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/ormapper/behavior/index.html">Behavior</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/conditionbean/index.html">ConditionBean</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/function/ormapper/outsidesql/index.html">OutsideSql</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/entity/index.html">Entity</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/runtime/index.html">DBFluteランタイム</a></li>
			</ul>
		</li>
		<li>
			<a href="../../../../../../ja/manual/function/genbafit/index.html">現場フィット</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/genbafit/implfit/index.html">アプリ実装の全体最適</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/projectfit/index.html">プロジェクト構成対応</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/function/genbafit/runtimefit/index.html">実行時共通要件の実現</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/deprecatedfit/index.html">非推奨な構造フォロー</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/dbflutefit/index.html">DBFluteサポート</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/function/helper/index.html">支援ツール</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/helper/emecha/index.html">EMecha(Eclipse Plugin)</a></li>
				<li><a href="../../../../../../ja/manual/function/helper/maven/index.html">Maven DBFlute Plugin</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/reference/index.html">リファレンス</a>
			<ul>
				<li><a href="../../../../../../ja/manual/reference/dbway/index.html">DBMSごとの取扱い</a></li>
				<li><a href="../../../../../../ja/manual/reference/diway/index.html">DIコンテナごとの取扱い</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/reference/dfprop/index.html">DBFluteプロパティ</a></li>
				<li><a href="../../../../../../ja/manual/reference/dictionary/index.html">DBFlute用語集</a></li>
				<li><a href="../../../../../../ja/manual/reference/example/index.html">DBFlute Example</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/reference/faq/index.html">FAQ</a></li>
				<li><a href="../../../../../../ja/manual/reference/troubleshooting/index.html">トラブルシューティング</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/topic/index.html">トピック</a>
			<ul>
				<li><a href="../../../../../../ja/manual/topic/dbdesign/index.html">DB設計</a></li>
				<li><a href="../../../../../../ja/manual/topic/programming/index.html">プログラミング</a></li>
				<li><a href="../../../../../../ja/manual/topic/friends/index.html">他のフレームワーク</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/topic/office/index.html">事務的な話</a></li>
				<li><a href="../../../../../../ja/manual/topic/dbflutenet/index.html">DBFlute.NET</a></li>
			</ul>
		</li>
	</ul>

</div>

<div id="footer">
	<div><a href="../../../../../../ja/sitemap.html">SiteMap</a> <a href="http://d.hatena.ne.jp/jflute">Author's Blog</a><a href="https://www.seasar.org/issues/browse/DBFLUTE">BTS</a></div>
	<ul class="footer-navi">
		<li class="hd-introduction"><a href="../../../../../../ja/introduction/index.html">Introduction</a></li>
		<li class="hd-tutorial"><a href="../../../../../../ja/tutorial/index.html">Tutorial</a>
			<ul>
				<li class="hd-architect"><a href="../../../../../../ja/tutorial/architect.html">for Architect</a></li>
				<li class="hd-developer"><a href="../../../../../../ja/tutorial/developer.html">for Developer</a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../../../../ja/environment/index.html">Environment</a>
			<ul>
				<li class="hd-install"><a href="../../../../../../ja/environment/setup/index.html">Setup</a></li>
				<li class="hd-upgrade"><a href="../../../../../../ja/environment/upgrade/index.html">Upgrade</a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../../../../ja/manual/index.html">Manual</a></li>
	</ul>

</div>

</div>
</body>
</html>
