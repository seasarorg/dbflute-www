<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta name="keywords" content="DBFlute,ConditionBean,query,FromTo,範囲条件,範囲検索" />
	<link rel="stylesheet" type="text/css" href="../../../../../../css/sub.css" />
	<!--[if IE 6.0]>
		<link rel="stylesheet" type="text/css" href="../../../../../../css/cb/sub.css" />
	<![endif]--> 
	<title>日時の汎用的なFromTo条件 | DBFlute</title>
</head>
<body>
<div id="container" class="ct-manual">

<div id="mainbar">
<div id="header">
	<div class="navi-upper"><a href="../../../../../../ja/sitemap.html">SiteMap</a>|<a href="http://d.hatena.ne.jp/jflute/">Author's Blog</a></div>
	<div class="navi-main">
	<ul>
		<li class="hd-introduction"><a href="../../../../../../ja/introduction/index.html"><img src="../../../../../../image/parts/navi/link-intro.png" alt="Introduction" width="75" height="32" /></a></li>
		<li class="hd-tutorial"><a href="../../../../../../ja/tutorial/index.html"><img src="../../../../../../image/parts/navi/link-tuto.png" alt="Tutorial" width="56" height="24" /></a>
			<ul>
				<li class="hd-architect"><a href="../../../../../../ja/tutorial/architect.html"><img src="../../../../../../image/parts/navi/link-arch.png" alt="for Architect" width="80" height="24" /></a></li>
				<li class="hd-developer"><a href="../../../../../../ja/tutorial/developer.html"><img src="../../../../../../image/parts/navi/link-dev.png" alt="for Developer" width="87" height="24" /></a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../../../../ja/environment/index.html"><img src="../../../../../../image/parts/navi/link-env.png" alt="Environment" width="84" height="25" /></a>
			<ul>
				<li class="hd-install"><a href="../../../../../../ja/environment/setup/index.html"><img src="../../../../../../image/parts/navi/link-setup.png" alt="Setup" width="42" height="24" /></a></li>
				<li class="hd-upgrade"><a href="../../../../../../ja/environment/upgrade/index.html"><img src="../../../../../../image/parts/navi/link-upgrade.png" alt="Upgrade" width="61" height="25" /></a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../../../../ja/manual/index.html"><img src="../../../../../../image/parts/navi/link-manual.png" alt="Manual" width="62" height="25" /></a></li>
	</ul>
	</div>
</div>

<div id="content">
	<h1>日時の汎用的なFromTo条件</h1>
	<ul class="indexlist">
		<li><a href="#overview">概要</a>
			<ul>
				<li><a href="#basicconcept">基本概念</a></li>
			</ul>
		</li>
		<li><a href="#howto">実装方法</a>
			<ul>
				<li><a href="#implflow">実装の流れ</a></li>
			</ul>
		</li>
		<li><a href="#pattern">パターンの比較条件</a>
			<ul>
				<li><a href="#date">日付による範囲条件 (yyyy/MM/dd)</a></li>
				<li><a href="#month">月による範囲条件 (yyyy/MM)</a></li>
				<li><a href="#year">年による範囲条件 (yyyy)</a></li>
			</ul>
		</li>
		<li><a href="#manual">手動で比較条件を調整</a></li>
		<li><a href="#methodspec">メソッド仕様</a>
			<ul>
				<li><a href="#basicspec">基本仕様</a></li>
				<li><a href="#argumenttype">条件値の型は java.util.Date</a></li>
				<li><a href="#argumentplain">条件値の日付の値はそのまま</a></li>
				<li><a href="#optionreuse">指定されたオプションの再利用</a></li>
			</ul>
		</li>
		<li><a href="#supported">サポートされる型</a></li>
	</ul>

	<h2 id="overview">概要</h2>
	<h3 id="basicconcept">基本概念</h3>
	<p>
		日時の汎用的なFromTo条件を設定します。FromTo は、絞り込み条件を表す ConditionKey です。
	</p>
	<div class="relatedpage"><a href="../about.html#conditionkey">ConditionBeanについて - ConditionKeyとは？</a></div>
	<p>
		内部的に GreaterEqual や LessThan などを利用して日時の範囲条件(foo から bar まで)を表現することができます。
		FromTo を利用しないと実現できない検索はありません。業務上よく利用される条件の組み合わせを汎用的に実現したものです。
	</p>
	<p>
		会話上では、<em class="keyword">ふろむとぅ</em> と表現します。
	</p>

	<h2 id="howto">実装方法</h2>
	<h3 id="implflow">実装の流れ</h3>
	<p>
		query() の後、<em class="keyword">set[date-column-name]_FromTo()</em>
		を呼び出し、第一引数に from に相当する条件値、第二引数に to に相当する条件値、第三引数に FromToOption (必須)を指定します。
	</p>
	<div class="relatedpage"><a href="../../runtime/fromtooption.html">DBFluteランタイム - FromToOption</a></div>
<pre><span class="codetitle">e.g. FromTo条件の実装手順 (Eclipseでコード補完) {FORMALIZED_DATETIME} @Java</span><code>
Date fromDate = <span class="abbreviation">...</span>
Date toDate = <span class="abbreviation">...</span>
cb.q <span class="comment">// .q と打って enter</span>
--
cb.query()
--
<span class="comment">// 1. .set まで打つとカラム選択</span>
<span class="comment">// 2. FD (FormalizedDatetime) でカラム確定</span>
<span class="comment">// 3. FT (FromTo) で enter</span>
cb.query().setFDFT
--
cb.query().<span class="point">setFormalizedDatetime_FromTo</span>(fromDate, toDate, option);
--
cb.query().setFormalizedDatetime_FromTo(fromDate, toDate
        , <span class="keyword">new</span> FromToOption().<span class="point">compareAsMonth()</span>);
</code></pre>

	<h2 id="pattern">パターンの比較条件</h2>
	<p>
		指定された条件値の精度を調整して、パターン化された範囲条件を組み立てることができます。
		これらの機能を使わなくても同じことは実現できますが、日付操作のちょっとしたバグの抑制や方式の統一に有効です。
	</p>
	<h3 id="date">日付による範囲条件 (yyyy/MM/dd)</h3>
	<p>
		<em class="keyword">compareAsDate()</em>
		を呼び出すと、時分秒は考慮せずに指定された条件値の日付の範囲内であるかどうかを判定する条件を組み立てます。
		指定された toDate の条件値の時分秒が幾つであろうと、次の日に進めて LessThan
		を利用し、該当の日のデータが完全に含まれるように自動的に調整されます。
		(同時に fromDate の時分秒は切り捨てられます)
	</p>
<pre><span class="codetitle">e.g. 日付で FromTo {FORMALIZED_DATETIME} @Java</span><code>
Date fromDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/10 08:24:53</span>
Date toDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/16 14:36:29</span>
cb.query().setFormalizedDatetime_FromTo(fromDate, toDate
        , <span class="keyword">new</span> FromToOption().<span class="point">compareAsDate()</span>);
</code></pre>
<pre><span class="codetitle">e.g. 日付で FromTo {FORMALIZED_DATETIME} @DisplaySql</span><code>
<span class="abbreviation">...</span>
 <span class="keyword">where</span> FORMALIZED_DATETIME &gt;= <span class="literal">'2007/04/10 00:00:00'</span>
   <span class="keyword">and</span> FORMALIZED_DATETIME &lt; <span class="literal">'2007/04/17 00:00:00'</span>
</code></pre>
	<p>
		FromTo の中で、利用頻度の一番高いものと想定されています。このパターンに限定した独立した ConditionKey、<em class="keyword">DateFromTo</em>
		が存在し、アプリで複数人・複数箇所で利用するような場合は、オプション指定の不要なそちらのメソッドを利用した方が良いでしょう。
	</p>
	<div class="detailpage"><a href="./datefromto.html">DateFromTo</a></div>
	<h3 id="month">月による範囲条件 (yyyy/MM)</h3>
	<p>
		<em class="keyword">compareAsMonth()</em>
		を呼び出すと、日および時分秒は考慮せずに指定された条件値の日付の範囲内であるかどうかを判定する条件が組み立てられます。
		指定された toDate の条件値の日および時分秒が幾つであろうと、次の月の最初の日に進めて LessThan
		を利用し、該当の月のデータが完全に含まれるように自動的に調整されます。
		(同時に fromDate の日および時分秒は切り捨てられます)
	</p>
<pre><span class="codetitle">e.g. 月で FromTo {FORMALIZED_DATETIME} @Java</span><code>
Date fromDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/10 08:24:53</span>
Date toDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/16 14:36:29</span>
cb.query().setFormalizedDatetime_FromTo(fromDate, toDate
        , <span class="keyword">new</span> FromToOption().<span class="point">compareAsMonth()</span>);
</code></pre>
<pre><span class="codetitle">e.g. 月で FromTo {FORMALIZED_DATETIME} @DisplaySql</span><code>
<span class="abbreviation">...</span>
 <span class="keyword">where</span> FORMALIZED_DATETIME &gt;= <span class="literal">'2007/04/01 00:00:00'</span>
   <span class="keyword">and</span> FORMALIZED_DATETIME &lt; <span class="literal">'2007/05/01 00:00:00'</span>
</code></pre>
	<h3 id="year">年による範囲条件 (yyyy)</h3>
	<p>
		<em class="keyword">compareAsYear()</em>
		を呼び出すと、月日および時分秒は考慮せずに指定された条件値の日付の範囲内であるかどうかを判定する条件が組み立てられます。
		指定された toDate の条件値の月日および時分秒が幾つであろうと、次の年の最初の日に進めて LessThan
		を利用し、該当の年のデータが完全に含まれるように自動的に調整されます。
		(同時に fromDate の月日および時分秒は切り捨てられます)
	</p>
<pre><span class="codetitle">e.g. 年で FromTo {FORMALIZED_DATETIME} @Java</span><code>
Date fromDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/10 08:24:53</span>
Date toDate = <span class="abbreviation">...</span> <span class="comment">// 2007/04/16 14:36:29</span>
cb.query().setFormalizedDatetime_FromTo(fromDate, toDate
        , <span class="keyword">new</span> FromToOption().<span class="point">compareAsYear()</span>);
</code></pre>
<pre><span class="codetitle">e.g. 年で FromTo {FORMALIZED_DATETIME} @DisplaySql</span><code>
<span class="abbreviation">...</span>
 <span class="keyword">where</span> FORMALIZED_DATETIME &gt;= <span class="literal">'2007/01/01 00:00:00'</span>
   <span class="keyword">and</span> FORMALIZED_DATETIME &lt; <span class="literal">'2008/01/01 00:00:00'</span>
</code></pre>

	<h2 id="manual">手動で比較条件を調整</h2>
	<p>
		用意されているパターンの比較条件に合致しない場合は、手動で比較条件を調整することができます。
	</p>
	<p>
		何もオプションが設定されていない FromToOption を指定した場合は、指定された条件値そのままに対して、単なる GreaterEqual と LessEqual
		を利用した範囲検索になります。Equal を Than に変えたい場合は、greaterThan(), lessThan() を呼び出すことで変更できます。
	</p>
<pre><span class="codetitle">e.g. from を GreaterThan に変更して FromTo {FORMALIZED_DATETIME} @Java</span><code>
cb.query().setFormalizedDatetime_FromTo(fromDate, toDate
        , <span class="keyword">new</span> FromToOption().<span class="point">greaterThan()</span>);
</code></pre>
	<p>
		さらに、FromToOption には日付を操作する幾つかの便利メソッドが用意されています。
		これらを活用して、業務にフィットする FromTo 条件を作り上げると良いでしょう。
	</p>
	<dl class="textlist">
		<dt>[from/to]PatternDayStart()</dt>
		<dd>[from/to]Date を、その日の最初の瞬間(時分秒ミリ秒を切り捨て)にして比較</dd>
		<dt>[from/to]PatternMonthStart()</dt><dd>[from/to]Date を、その月の最初の瞬間(日を 01、時分秒ミリ秒を切り捨て)にして比較</dd>
		<dt>[from/to]PatternYearStart()</dt><dd>[from/to]Date を、その年の最初の瞬間(月日を 01、時分秒ミリ秒を切り捨て)にして比較</dd>
		<dt>[from/to]DateWithNoon()</dt>
		<dd>
			[from/to]Date を、その日の正午ジャスト(日を 12、時分秒ミリ秒を切り捨て)にして比較 <span class="freecomment">@since 0.9.7.5</span>
		</dd>
		<dt>[from/to]DateWithHour(int hourOfDay)</dt>
		<dd>[from/to]Date を、その日の指定された時間ジャストにして比較 <span class="freecomment">@since 0.9.7.5</span></dd>
	</dl>
	<p>
		手動で設定する内容がアプリの複数箇所で利用される場合は、FromToOption 自体を拡張して、業務に合わせたアプリ独自の
		FromToOption を作って横展開すると良いでしょう。
	</p>
<pre><span class="codetitle">e.g. アプリ独自の FromToOption を作成 @Java</span><code>
<span class="keyword">public class</span> AppFromToOption <span class="keyword">extends</span> FromToOption {

    <span class="keyword">public</span> AppFromToOption() {
        <span class="comment">// アプリ全体で統一の比較条件の調整</span>
        <span class="abbreviation">...</span>
    }

    <span class="keyword">public</span> AppFromToOption arrangeAsPurchase<span class="abbreviation">...</span>() {
        <span class="comment">// 業務ごとに独自の比較条件の調整</span>
        clearAll();
        <span class="abbreviation">...</span>
        return this;
    }

    <span class="keyword">public</span> AppFromToOption arrangeAsLogin<span class="abbreviation">...</span>() {
        <span class="comment">// 業務ごとに独自の比較条件の調整</span>
        clearAll();
        <span class="abbreviation">...</span>
        return this;
    }
}
</code></pre>

	<h2 id="methodspec">メソッド仕様</h2>
	<h3 id="basicspec">基本仕様</h3>
	<dl class="textlist">
		<dt>nullの指定</dt>
		<dd>
			引数の fromDate と toDate が両方とも null
			の場合は、その条件は無効となります。片方だけが null
			の場合はもう一つの条件だけが有効になります。
		</dd>
		<dt>同カラムに対する複数条件の指定</dt>
		<dd>内部的に、GreaterEqual や LessThan など、別のメソッドを呼び出しているだけなので、その利用した条件の仕様通りです。</dd>
		<dt>同カラムに対する同じ条件値での複数指定</dt>
		<dd>内部的に、GreaterEqual や LessThan など、別のメソッドを呼び出しているだけなので、その利用した条件の仕様通りです。</dd>
	</dl>
	<h3 id="argumenttype">条件値の型は java.util.Date</h3>
	<p>
		プロパティの型が java.sql.Timestamp であっても、引数の条件値の型は java.util.Date
		です。java.sql.Timestamp は java.util.Date の継承クラスなので特に問題ありません。
	</p>
	<h3 id="argumentplain">条件値の日付の値はそのまま</h3>
	<p>
		内部での日付調整があっても、条件値として指定した日付オブジェクトの値はそのままです。
		内部では新たに日付オブジェクトを作成して利用しています。
	</p>
	<h3 id="optionreuse">指定されたオプションの再利用</h3>
	<p>
		FromToOption はスレッドセーフではありませんが、同じスレッド内であれば別のカラムに再利用することはできます。
		全く同じオプションで、別のカラムも曖昧検索する場合に利用できます。
	</p>

	<h2 id="supported">サポートされる型</h2>
	<ul>
		<li>Date 全般 <span class="freecomment">(DateやTimestampなど)</span></li>
	</ul>
	<div class="inucolumn">
		<h3>DATE だけのサポート</h3>
		<p>
			数値の FromTo はサポートしていません。数値よりも日付の方が業務上の特殊なパターンが存在すると考えれているためです。
			数値の場合は素直に GreaterEqual や LessThan を利用して実現しましょう。
		</p>
	</div>

</div>
</div>

<div id="sidebar">
	<div class="logo"><a href="../../../../../../"><img src="../../../../../../image/parts/logo.png" alt="dbflute-logo" width="240" height="110" /></a></div>
<ul>
		<li><a href="../../../../../../ja/manual/function/generator/index.html">自動生成ツール</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/generator/client/index.html">DBFluteクライアント</a></li>
				<li><a href="../../../../../../ja/manual/function/generator/module/index.html">DBFluteモジュール</a></li>
				<li><a href="../../../../../../ja/manual/function/generator/task/index.html">DBFluteタスク</a>
				<!-- 
					<ul>
						<li><a href="../../../../../../ja/manual/function/generator/task/jdbc/index.html">JDBC</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/generate/index.html">Generate</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/doc/index.html">Doc</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/sql2entity/index.html">Sql2Entity</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/outsidesqltest/index.html">OutsideSqlTest</a></li>
						<li><a href="../../../../../../ja/manual/function/generator/task/replaceschema/index.html">ReplaceSchema</a></li>
					</ul>
				 -->
				</li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/function/ormapper/index.html">O/Rマッパ</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/ormapper/behavior/index.html">Behavior</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/conditionbean/index.html">ConditionBean</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/function/ormapper/outsidesql/index.html">OutsideSql</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/entity/index.html">Entity</a></li>
				<li><a href="../../../../../../ja/manual/function/ormapper/runtime/index.html">DBFluteランタイム</a></li>
			</ul>
		</li>
		<li>
			<a href="../../../../../../ja/manual/function/genbafit/index.html">現場フィット</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/genbafit/implfit/index.html">アプリ実装の全体最適</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/projectfit/index.html">プロジェクト構成対応</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/function/genbafit/runtimefit/index.html">実行時共通要件の実現</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/deprecatedfit/index.html">非推奨な構造フォロー</a></li>
				<li><a href="../../../../../../ja/manual/function/genbafit/dbflutefit/index.html">DBFluteサポート</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/function/helper/index.html">支援ツール</a>
			<ul>
				<li><a href="../../../../../../ja/manual/function/helper/emecha/index.html">EMecha(Eclipse Plugin)</a></li>
				<li><a href="../../../../../../ja/manual/function/helper/maven/index.html">Maven DBFlute Plugin</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/reference/index.html">リファレンス</a>
			<ul>
				<li><a href="../../../../../../ja/manual/reference/dbway/index.html">DBMSごとの取扱い</a></li>
				<li><a href="../../../../../../ja/manual/reference/diway/index.html">DIコンテナごとの取扱い</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/reference/dfprop/index.html">DBFluteプロパティ</a></li>
				<li><a href="../../../../../../ja/manual/reference/dictionary/index.html">DBFlute用語集</a></li>
				<li><a href="../../../../../../ja/manual/reference/example/index.html">DBFlute Example</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/reference/faq/index.html">FAQ</a></li>
				<li><a href="../../../../../../ja/manual/reference/troubleshooting/index.html">トラブルシューティング</a></li>
			</ul>
		</li>
		<li><a href="../../../../../../ja/manual/topic/index.html">トピック</a>
			<ul>
				<li><a href="../../../../../../ja/manual/topic/dbdesign/index.html">DB設計</a></li>
				<li><a href="../../../../../../ja/manual/topic/programming/index.html">プログラミング</a></li>
				<li><a href="../../../../../../ja/manual/topic/friends/index.html">他のフレームワーク</a></li>
				<li class="upper-space"><a href="../../../../../../ja/manual/topic/office/index.html">事務的な話</a></li>
				<li><a href="../../../../../../ja/manual/topic/dbflutenet/index.html">DBFlute.NET</a></li>
			</ul>
		</li>
	</ul>

</div>

<div id="footer">
	<div><a href="../../../../../../ja/sitemap.html">SiteMap</a> <a href="http://d.hatena.ne.jp/jflute">Author's Blog</a><a href="https://www.seasar.org/issues/browse/DBFLUTE">BTS</a></div>
	<ul class="footer-navi">
		<li class="hd-introduction"><a href="../../../../../../ja/introduction/index.html">Introduction</a></li>
		<li class="hd-tutorial"><a href="../../../../../../ja/tutorial/index.html">Tutorial</a>
			<ul>
				<li class="hd-architect"><a href="../../../../../../ja/tutorial/architect.html">for Architect</a></li>
				<li class="hd-developer"><a href="../../../../../../ja/tutorial/developer.html">for Developer</a></li>
			</ul>
		</li>
		<li class="hd-environment"><a href="../../../../../../ja/environment/index.html">Environment</a>
			<ul>
				<li class="hd-install"><a href="../../../../../../ja/environment/setup/index.html">Setup</a></li>
				<li class="hd-upgrade"><a href="../../../../../../ja/environment/upgrade/index.html">Upgrade</a></li>
			</ul>
		</li>
		<li class="hd-manual"><a href="../../../../../../ja/manual/index.html">Manual</a></li>
	</ul>

</div>

</div>
</body>
</html>
