<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- don't edit start -->
<head>
<title>Seasar - DI Container with AOP - </title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen" />
<link href="seasar_p.css" type="text/css" rel="stylesheet" media="print" />
<script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script>
</head>
<body onload="preload('ja')">
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="left"><tr>
<td align="left" valign="top" width="780"><table width="780" border="0" cellspacing="0" cellpadding="0" class="white">
<tr><td colspan="7"><img height="5" width="780" src="images/top01_b.gif" alt=""></td></tr>
<tr><td><img height="117" width="235" src="images/top02_b.gif" alt="Seasar"></td>
<td colspan="3"><img height="117" width="289" src="images/top03.gif" alt="DI Container with AOP"></td>
<td colspan="3"><img height="117" width="256" src="images/spacer.gif" alt=""></td>
</tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235"></td>
<td><a href="http://www.seasar.org/index.html"><img src="images/menu01_b_ja.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td>
<td><a href="http://www.seasar.org/projects.html"><img src="images/menu02_b_ja.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td>
<td><a href="http://www.seasar.org/products.html"><img src="images/menu03_b_ja.gif" height="30" width="110" border="0" alt="" id="menu03" onmouseover="swap(3)" onmouseout="restore(3)"></a></td>
<td><a href="http://www.seasar.org/resources.html"><img src="images/menu04_b_ja.gif" height="30" width="113" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td>
<td><img src="images/menu05_b_ja.gif" height="30" width="109" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></td>
<td><img height="30" width="34" src="images/menu06.gif" alt=""></td></tr><tr>
<td colspan="6"><img height="19" width="545" src="images/spacer.gif" alt=""></td></tr></table>
<table  width="780" border="0" cellspacing="0" cellpadding="0" class="white">
<tr align="left" valign="top"><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td><td width="740" class="main">
<!-- don't edit end -->
<!-- document start -->
<p>
<a href="index.html">to Top</a>
<p><b>
Behaviorについて記述します。
<p></b>
<pre>


// ======================================================================================================
//                                                                                               Behavior
//                                                                                               ========

# ------------------------------------------------
#                                What is behavior?
#                                -----------------

Dataの振舞いを定義するObjectです。

ある画面「S1」でTable「T1」に対して行う処理を、とある画面「S2」においても行う場合は、
それは、「T1」のBehaviorにMethodを定義して「S1」と「S2」から再利用できるようにします。
そのうち、「T1」への同じ処理が含まれる「S3」が出てくるかもしれません。
そのときは、Behaviorに定義した呼べばよいだけです。

再利用をどのような基準で行うかはProjectによって様々ですが、DBFluteではこのような領域を用意しています。
また、Behaviorに上記のような独自のMethodを定義しなくても、GenerateされたSuperClassのBehaviorには
便利なMethodが数多く存在します。それを利用するだけでも十分価値があります。



# ------------------------------------------------
#                              How to use behavior
#                              -------------------

Behaviorは、dao.diconにてInterfaceを持たないClassとしてComponent登録されます。
Interfaceを持たないため、Setter-Injectionされるか否かはS2ContainerのVersionに依存します。

Interfaceを持たないComponentもSetter-InjectionされるVersionの場合は、
利用したいBehaviorのComponentのNameをProperty名としてSetterを用意すればInjectionされます。

    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public class Xxx {
        public void setBookBhv(LdBookBhv bookBhv) {
            this.bookBhv = bookBhv;
        }
        public void executeXxx() {
            final LdBook entity = LdBook();
            entity.setBookId(123);
            entity.setBookName("xxx");
            this.bookBhv.insertOrUpdateAfterSelect(cb);
        }
    }
    - - - - - - - - /


そうでない場合は、S2ContainerからgetComponentするか、もしくは、DaoSelectorなるComponentから
BehaviorのInstanceを取得します。
DaoSelectorは、全てのDaoとBehaviorへの参照を保持しています。DaoSelector自体がComponent登録されているため、
Setter-Injectionされるので、DaoSelectorのSetterを用意してDaoSelectorからBehaviorを取得します。

    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public class Xxx {
        public void setDaoSelector(LdDaoSelector daoSelector) {
            this.daoSelector = daoSelector;
        }
        public void executeXxx() {
            final LdBook entity = LdBook();
            entity.setBookId(123);
            entity.setBookName("xxx");
            final LdBookBhv bhv = (LdBookBhv)this.daoSelector.getWBhv(LdBookBhv.class);
            bhv.insertOrUpdateAfterSelect(cb);
        }
    }
    - - - - - - - - /



# -------------------------------------------------
#          What kind of methods does behavior have?
#          ----------------------------------------

大きく分類して２種類：

  A. Daoへ処理を委譲するだけのDelegate-Method。
  B. 様々な振舞いを付加して「A」を利用するMethod。


「A」に関しては、２つ目的があります。

  A-1. BehaviorだけでDB-Accessができるようにすること。
         →利用Class側が、BehaviorもDaoも両方扱うのはややこしい。Behaviorがあればよい。
  A-2. AspectのPointcutとして「A」のMethodを利用する。


「B」に関しては、後述するMethodを説明を見てもらった方が説明が早いです。



_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                Methodの用途別概要
                _/_/_/_/_/_/_/_/_/

＜Entity検索＞

ConditionBeanによるEntity検索：

  → delegateSelectEntity()


ConditionBeanによる「nullを期待しない」Entity検索：

  → selectEntityWithDeletedCheck();


PrimaryKeyによる「nullを期待しない」Entity検索：

  → selectByPKValueWithDeletedCheck();


PrimaryKeyによる「更新Lock付きでnullを期待しない」Entity検索：

  → selectForUpdateByPKValueWithDeletedCheck()


＜List検索＞

ConditionBeanによるList検索：

  → delegateSelectList()


ConditionBeanによる「ListResultBeanを戻り値とした」List検索：

  → selectList()


ConditionBeanによる「PagingResultBeanを戻り値とした」Paging検索：

  → selectPage()


＜登録＞

通常の登録：

  → delegateInsert()


なければ登録、あれば更新：

  → insertOrUpdateAfterSelect()


なければ登録、あれば更新｛更新Lock付き｝：

  → insertOrUpdateAfterSelectForUpdate()


＜更新＞

通常の更新：

  → delegateUpdate()


事前に検索して取得したEntityに対してMergeして更新：

  → updateAfterSelect()

    ※引数のEntityにTimestampやVersionNoなどの排他制御用の値を格納しない場合は、
      DB上に格納されている値をそのまま利用する。つまり排他制御は実質しない。


事前に検索して取得したEntityに対してMergeして更新｛更新Lock付き｝：

  → updateAfterSelectForUpdate()



_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                  Methodの詳細説明
                _/_/_/_/_/_/_/_/_/


    // =====================================================================================
    //                                                                       Delegate Method
    //                                                                       ===============

    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateGetCountAll() {
        return getMyDao().getCountAll();
    }
    - - - - - - - - /

        Daoに定義されている「Recordの総件数の取得」のMethodに対するDelegateです。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public java.util.List&lt;LdBook&gt; delegateGetListAll() {
        return getMyDao().getListAll();
    }
    - - - - - - - - /

        Daoに定義されている「Recordの全件取得」のMethodに対するDelegateです。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public LdBook delegateGetEntity(java.math.BigDecimal bookId) {
        return getMyDao().getEntity(bookId);
    }
    - - - - - - - - /

        Daoに定義されている「主キーによる一件取得」のMethodに対するDelegateです。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateSelectCountIgnoreFetchScope(LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        return getMyDao().selectCountIgnoreFetchScope(cb);
    }
    - - - - - - - - /

        Daoに定義されている「ConditionBeanによる条件でFetchScopeを無視した件数取得」のMethodに対するDelegateです。
          →FetchScopeは、ConditionBean.fetchFirst()/fetchScope()/fetchPage()などのLimitSearch検索のことです。
            つまり、ConditionBeanで876件取得できる条件でHITする81-100件目を取得するように設定しても、
            このMethodでは、「876」が戻ります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public LdBook delegateSelectEntity(LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        return getMyDao().selectEntity(cb);
    }
    - - - - - - - - /

        Daoに定義されている「ConditionBeanによる条件で一件取得」のMethodに対するDelegateです。
        複数件HITしてしまう条件で検索した場合は、S2Daoの仕様通りとなります。
          →2006/12/19時点のS2Dao-1.0.39では、最初の一件が戻ります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public java.util.List&lt;LdBook&gt; delegateSelectList(LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        return getMyDao().selectList(cb);
    }
    - - - - - - - - /

        Daoに定義されている「ConditionBeanによる条件で一覧取得」のMethodに対するDelegateです。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public java.math.BigDecimal delegateSelectNextVal() {
        return getMyDao().selectNextVal();
    }
    - - - - - - - - /

        build.propertiesにてSequenceの設定をした場合の
        Daoに定義されている「Sequence取得」のMethodに対するDelegateです。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateInsert(LdBook entity) {
        assertEntityNotNull(entity);// If this table use identity, the entity does not have primary-key.
        filterEntityOfInsert(entity);
        assertEntityOfInsert(entity);
        return getMyDao().insert(entity);
    }
    - - - - - - - - /

        Daoに定義されている「insert()」のMethodに対するDelegateです。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateUpdate(LdBook entity) {
        assertEntityNotNullAndHasPrimaryKeyValue(entity);
        filterEntityOfUpdate(entity);
        assertEntityOfUpdate(entity);
        return getMyDao().updateModifiedOnly(entity);
    }
    - - - - - - - - /

        Daoに定義されている「updateModifiedOnly()」のMethodに対するDelegateです。
        EntityのSetterが呼び出されたColumnだけでUpdate文のSet句を作成します。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateDelete(LdBook entity) {
        assertEntityNotNullAndHasPrimaryKeyValue(entity);
        filterEntityOfDelete(entity);
        assertEntityOfDelete(entity);
        return getMyDao().delete(entity);
    }
    - - - - - - - - /

        Daoに定義されている「delete()」のMethodに対するDelegateです。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateInsertList(java.util.List&lt;LdBook&gt; entityList) {
        assertListNotNullAndEmpty(entityList);
        return getMyDao().insertList(entityList);
    }
    - - - - - - - - /

        Daoに定義されている「Batch-Insert」のMethodに対するDelegateです。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateUpdateList(java.util.List&lt;LdBook&gt; entityList) {
        assertListNotNullAndEmpty(entityList);
        return getMyDao().updateList(entityList);
    }
    - - - - - - - - /

        Daoに定義されている「Batch-Update」のMethodに対するDelegateです。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public int delegateDeleteList(java.util.List&lt;LdBook&gt; entityList) {
        assertListNotNullAndEmpty(entityList);
        return getMyDao().deleteList(entityList);
    }
    - - - - - - - - /

        Daoに定義されている「Batch-Delete」のMethodに対するDelegateです。
        build.propertiesにてCommonColumn(共通列)のInterceptorを設定したときは、このMethodにAspectが掛かります。


    // =====================================================================================
    //                                                                          Basic Select
    //                                                                          ============

    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public LdListResultBean&lt;LdBook&gt; selectList(LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        return new ResultBeanBuilder&lt;LdBook&gt;(this).buildListResultBean(cb, delegateSelectList(cb));
    }
    - - - - - - - - /

        指定されたConditionBeanで条件にHITする検索結果をListResultBeanの形で戻します。
          →ListResultBeanは、以下の要素を保持します。
              - 検索したTable名
              - 総件数
              - 検索結果(List)
              - OrderBy情報


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    public LdPagingResultBean&lt;LdBook&gt; selectPage(final LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        return selectPage(cb, new SelectPageSimpleInvoker&lt;LdBook&gt;(this));
    }
    - - - - - - - - /

        指定されたConditionBeanで条件にHITするPagingの検索結果をPageResultBeanの形で戻します。
          →PageResultBeanは、以下の要素を保持します。
              - 検索したTable名 ｛ListResultBean継承｝
              - 総件数          ｛ListResultBean継承｝
              - 検索結果(List)  ｛ListResultBean継承｝
              - OrderBy情報     ｛ListResultBean継承｝
              - 1Page当たりのSize
              - 現在のPage番号
              - 総Page数
              - その他

            ※PageResultBeanは非常に便利なObjectです。参考｛<a href="./tips-paging.html">Tips: Paging</a>｝


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    /**
     * Select page.
     * 
     * @param cb Condition-bean. (NotNull)
     * @param invoker Select-page-invoker (NotNull)
     * @return Selected page as first page. (NotNull)
     */
    public LdPagingResultBean&lt;LdBook&gt; selectPage(final LdBookCB cb, SelectPageInvoker&lt;LdBook&gt; invoker) {
        assertConditionBeanNotNull(cb);
        final SelectPageCallback&lt;LdBook&gt; pageCallback = new SelectPageCallback&lt;LdBook&gt;() {
            public LdPagingBean getPagingBean() { return cb; }
            public int selectCountIgnoreFetchScope() {
                return delegateSelectCountIgnoreFetchScope(cb);
            }
            public java.util.List&lt;LdBook&gt; selectList() {
                return delegateSelectList(cb);
            }
        };
        return invoker.invokeSelectPage(pageCallback);
    }
    - - - - - - - - /

        selectPage(LdBookCB cb);と同様です。
        こちらは、Invokerを指定して、Paging検索時の挙動を独自に変更することができます。


    / - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    /**
     * Select entity by condition-bean with deleted check.
     * 
     * @param cb Condition-bean. (NotNull)
     * @return Entity that is selected from database by select-for-update. (NotNull)
     * @exception dbflute.ldb.allcommon.exception.LdRecordHasAlreadyBeenDeletedException
     */
    public LdBook selectEntityWithDeletedCheck(LdBookCB cb) {
        assertConditionBeanNotNull(cb);
        dbflute.ldb.exentity.LdBook currentEntity = delegateSelectEntity(cb);
        assertRecordHasNotBeenDeleted(currentEntity, cb.toString());
        return currentEntity;
    }
    - - - - - - - - /

        削除されたか否かをCheckする一件検索です(nullを期待しない検索)。
        該当の条件で検索結果が1件で無い場合は、専用の例外が発生します。







TODO: 書き途中です。



</pre>
</p>

<!-- document end -->
</html>
